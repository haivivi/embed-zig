load("//bazel:env.bzl", "make_env_file")
load("//bazel/bk:defs.bzl", "bk_flash", "bk_modules", "bk_zig_app")
load("//bazel/bk/kconfig:defs.bzl", "bk_config")
load("//bazel/bk/kconfig:crypto.bzl", "bk_crypto")
load("//bazel/bk/partition:presets.bzl", "bk7258_default_partitions")

package(default_visibility = ["//visibility:public"])

filegroup(
    name = "srcs",
    srcs = ["//examples/apps/https_speed_test:app_srcs"] + glob(["**/*"]),
)

make_env_file(
    name = "env",
    defines = ["WIFI_SSID", "WIFI_PASSWORD"],
)

bk_crypto(name = "crypto")
bk_config(name = "kconfig", modules = [":crypto"])

bk7258_default_partitions()
bk_modules()

bk_zig_app(
    name = "app",
    ap = ":srcs",
    cp = "//lib/platform/bk/cp:base",
    deps = [":bk", "//lib/hal", "//lib/trait", "//lib/pkg/tls", "//lib/pkg/dns"],
    partition_table = ":partitions",
    env = ":env",
    kconfig_ap = ":kconfig",
    c_helpers = [
        "//lib/platform/bk/armino:c_helpers_core",
        "//lib/platform/bk/armino:c_helpers_wifi",
        "//lib/platform/bk/armino:c_helpers_socket",
        "//lib/platform/bk/armino:c_helpers_crypto",
    ],
)

bk_flash(name = "flash", app = ":app")
