load("//bazel/zig:defs.bzl", "zig_library")

package(default_visibility = ["//visibility:public"])

# Common args shared by both variants
_COMMON_C_FLAGS = ["-DOPUS_BUILD", "-DHAVE_LRINTF", "-DVAR_ARRAYS"]

# Opus compiled with FIXED_POINT — no float, fast on Xtensa/embedded
zig_library(
    name = "opus_fixed",
    main = "opus.zig",
    srcs = ["opus.zig"],
    c_srcs = [
        "@opus//:core_srcs",
        "@opus//:fixed_srcs",
        "@opus//:headers",
    ],
    c_flags = _COMMON_C_FLAGS + ["-DFIXED_POINT"],
    link_libc = True,
    module_name = "opus",
)

# Opus compiled with float SILK — better quality, needs FPU
zig_library(
    name = "opus_float",
    main = "opus.zig",
    srcs = ["opus.zig"],
    c_srcs = [
        "@opus//:core_srcs",
        "@opus//:float_srcs",
        "@opus//:headers",
    ],
    c_flags = _COMMON_C_FLAGS,
    link_libc = True,
    module_name = "opus",
)

filegroup(name = "srcs", srcs = glob(["**/*"]))
